{
  "version": 3,
  "sources": ["../src/enet.ts"],
  "sourcesContent": ["\r\nimport EnetWrapper, { ENetEvent, EnetPacketAddress, EnetSocketAddress, eventType, packetFlag } from './enet-wrapper';\r\nimport { delay } from './utils';\r\n\r\nexport class EnetSocket {\r\n\r\n    static packetFlag = packetFlag;\r\n    static eventType = eventType;\r\n\r\n    static freePacket(packet: EnetPacketAddress) {\r\n        // should be called after packet data is processed\r\n        EnetWrapper.freePacket(packet);\r\n    }\r\n\r\n    socket;\r\n    netLoopRunning = false;\r\n\r\n    constructor(socket: EnetSocketAddress | undefined = undefined) {\r\n        this.socket = socket || EnetWrapper.createSocket();\r\n        if (!this.socket)\r\n            throw new Error('Failed to initialize enet socket');\r\n    }\r\n\r\n    bind(port: number, ip: string) {\r\n        const binded = EnetWrapper.bind(this.socket, port, ip);\r\n        if (!binded)\r\n            throw new Error(\"Failed to bind socket\");\r\n    }\r\n\r\n    destroy() {\r\n        this.netLoopRunning = false;\r\n        EnetWrapper.destroy(this.socket);\r\n    }\r\n\r\n    connect(port: number, ip: string) {\r\n        // peer is not null even if connection fails\r\n        // service will emit connect or disconnect event\r\n        const peer = EnetWrapper.connect(this.socket, port, ip);\r\n        if (!peer)\r\n            throw new Error(\"Failed to connect socket\");\r\n    }\r\n\r\n    disconnect(peerNum: number, soon: boolean = false) {\r\n        EnetWrapper.disconnect(this.socket, peerNum, soon);\r\n    }\r\n\r\n    send(peerNum: number, data: ArrayBufferLike, channel: number = 0, flags: number = packetFlag.reliable) {\r\n        return EnetWrapper.send(this.socket, peerNum, data, channel, flags);\r\n    }\r\n\r\n    service() {\r\n        // TODO: promise?\r\n        return EnetWrapper.service(this.socket);\r\n    }\r\n\r\n    async netLoop(callback: (msg: ENetEvent) => void) {\r\n        if (this.netLoopRunning)\r\n            return;\r\n\r\n        this.netLoopRunning = true;\r\n\r\n        for (; ;) {\r\n            if (!this.netLoopRunning)\r\n                break;\r\n\r\n            const msg = this.service();\r\n            if (!msg.type) {\r\n                await delay(1);\r\n                continue;\r\n            }\r\n\r\n            callback(msg);\r\n        }\r\n    }\r\n\r\n    setBlowfish(peerNum: number, base64Key: string) {\r\n        EnetWrapper.setBlowfish(this.socket, peerNum, base64Key);\r\n    }\r\n\r\n}\r\n\r\nexport default class Enet {\r\n    static createSocket() {\r\n        const enet = new EnetSocket();\r\n        return enet;\r\n    }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,0BAAoG;AACpG,mBAAsB;AAEf,MAAM,WAAW;AAAA,EAJxB,OAIwB;AAAA;AAAA;AAAA,EAEpB,OAAO,aAAa;AAAA,EACpB,OAAO,YAAY;AAAA,EAEnB,OAAO,WAAW,QAA2B;AAEzC,wBAAAA,QAAY,WAAW,MAAM;AAAA,EACjC;AAAA,EAEA;AAAA,EACA,iBAAiB;AAAA,EAEjB,YAAY,SAAwC,QAAW;AAC3D,SAAK,SAAS,UAAU,oBAAAA,QAAY,aAAa;AACjD,QAAI,CAAC,KAAK;AACN,YAAM,IAAI,MAAM,kCAAkC;AAAA,EAC1D;AAAA,EAEA,KAAK,MAAc,IAAY;AAC3B,UAAM,SAAS,oBAAAA,QAAY,KAAK,KAAK,QAAQ,MAAM,EAAE;AACrD,QAAI,CAAC;AACD,YAAM,IAAI,MAAM,uBAAuB;AAAA,EAC/C;AAAA,EAEA,UAAU;AACN,SAAK,iBAAiB;AACtB,wBAAAA,QAAY,QAAQ,KAAK,MAAM;AAAA,EACnC;AAAA,EAEA,QAAQ,MAAc,IAAY;AAG9B,UAAM,OAAO,oBAAAA,QAAY,QAAQ,KAAK,QAAQ,MAAM,EAAE;AACtD,QAAI,CAAC;AACD,YAAM,IAAI,MAAM,0BAA0B;AAAA,EAClD;AAAA,EAEA,WAAW,SAAiB,OAAgB,OAAO;AAC/C,wBAAAA,QAAY,WAAW,KAAK,QAAQ,SAAS,IAAI;AAAA,EACrD;AAAA,EAEA,KAAK,SAAiB,MAAuB,UAAkB,GAAG,QAAgB,+BAAW,UAAU;AACnG,WAAO,oBAAAA,QAAY,KAAK,KAAK,QAAQ,SAAS,MAAM,SAAS,KAAK;AAAA,EACtE;AAAA,EAEA,UAAU;AAEN,WAAO,oBAAAA,QAAY,QAAQ,KAAK,MAAM;AAAA,EAC1C;AAAA,EAEA,MAAM,QAAQ,UAAoC;AAC9C,QAAI,KAAK;AACL;AAEJ,SAAK,iBAAiB;AAEtB,eAAU;AACN,UAAI,CAAC,KAAK;AACN;AAEJ,YAAM,MAAM,KAAK,QAAQ;AACzB,UAAI,CAAC,IAAI,MAAM;AACX,kBAAM,oBAAM,CAAC;AACb;AAAA,MACJ;AAEA,eAAS,GAAG;AAAA,IAChB;AAAA,EACJ;AAAA,EAEA,YAAY,SAAiB,WAAmB;AAC5C,wBAAAA,QAAY,YAAY,KAAK,QAAQ,SAAS,SAAS;AAAA,EAC3D;AAEJ;AAEA,MAAO,KAAmB;AAAA,EAjF1B,OAiF0B;AAAA;AAAA;AAAA,EACtB,OAAO,eAAe;AAClB,UAAM,OAAO,IAAI,WAAW;AAC5B,WAAO;AAAA,EACX;AACJ;",
  "names": ["EnetWrapper"]
}
